# 🌐 云端部署完整指南

## 🎯 目标
- ✅ 您和合伙人可以同时使用
- ✅ 数据实时共享同步
- ✅ 随时随地访问
- ✅ 完全免费方案

## 📋 部署步骤

### 第一步：设置云数据库 (10分钟)

#### 1.1 注册Supabase
1. 访问 [supabase.com](https://supabase.com)
2. 点击 "Start your project"
3. 使用GitHub账户登录（推荐）

#### 1.2 创建新项目
1. 点击 "New project"
2. 项目名称：`fund-management`
3. 数据库密码：设置一个强密码（记住这个密码）
4. 区域：选择 "Singapore" （亚洲最近）
5. 点击 "Create new project"

#### 1.3 获取连接信息
项目创建完成后，在Settings → API页面找到：
- `Project URL`：https://xxx.supabase.co
- `anon public key`：eyJhbG...（很长的字符串）

### 第二步：创建数据库表 (5分钟)

在Supabase的SQL Editor中运行以下SQL：

```sql
-- 策略表
CREATE TABLE strategies (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    start_date DATE,
    initial_nav DECIMAL(10,3) DEFAULT 1.000,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 净值记录表
CREATE TABLE nav_records (
    id SERIAL PRIMARY KEY,
    strategy_id INTEGER REFERENCES strategies(id),
    date DATE NOT NULL,
    nav_value DECIMAL(10,3) NOT NULL,
    return_rate DECIMAL(8,4),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(strategy_id, date)
);

-- 投资人表
CREATE TABLE investors (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品表
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品策略权重表
CREATE TABLE product_strategy_weights (
    id SERIAL PRIMARY KEY,
    product_id INTEGER REFERENCES products(id),
    strategy_id INTEGER REFERENCES strategies(id),
    weight DECIMAL(5,4) NOT NULL,
    effective_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 投资记录表
CREATE TABLE investments (
    id SERIAL PRIMARY KEY,
    investor_id INTEGER REFERENCES investors(id),
    product_id INTEGER REFERENCES products(id),
    investment_date DATE NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    shares DECIMAL(15,6),
    nav_at_investment DECIMAL(10,3),
    type VARCHAR(20) CHECK(type IN ('investment', 'redemption')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_nav_records_date ON nav_records(date);
CREATE INDEX idx_nav_records_strategy ON nav_records(strategy_id);
CREATE INDEX idx_investments_investor ON investments(investor_id);
CREATE INDEX idx_investments_product ON investments(product_id);
```

### 第三步：修改代码支持云数据库 (15分钟)

我已经为您准备好了云数据库版本的代码，需要做以下修改：

#### 3.1 更新requirements.txt
在requirements.txt中添加：
```
requests
supabase
```

#### 3.2 更新数据库管理代码
（代码已准备好，稍后提供）

### 第四步：创建GitHub仓库 (10分钟)

#### 4.1 创建仓库
1. 访问 [github.com](https://github.com)
2. 点击右上角 "+" → "New repository"
3. 仓库名：`fund-management-system`
4. 设为 Public（免费用户必须公开）
5. 创建仓库

#### 4.2 上传代码
在项目目录运行：
```bash
git init
git add .
git commit -m "初始版本"
git branch -M main
git remote add origin https://github.com/你的用户名/fund-management-system.git
git push -u origin main
```

### 第五步：部署到Streamlit Cloud (5分钟)

#### 5.1 访问Streamlit Cloud
1. 访问 [share.streamlit.io](https://share.streamlit.io)
2. 使用GitHub账户登录

#### 5.2 创建应用
1. 点击 "New app"
2. 选择您刚创建的GitHub仓库
3. Main file path: `app.py`
4. 点击 "Deploy!"

#### 5.3 配置密钥
在Streamlit Cloud的应用设置中，添加Secrets：
```toml
SUPABASE_URL = "https://xxx.supabase.co"
SUPABASE_ANON_KEY = "eyJhbG..."
```

### 第六步：测试和优化 (10分钟)

#### 6.1 功能测试
- 添加策略
- 录入净值
- 查看图表
- 添加投资人

#### 6.2 数据共享测试
- 在一个浏览器中录入数据
- 在另一个浏览器（或手机）中查看
- 验证数据同步

## 🎉 部署完成后

### 访问地址
您的系统将有一个类似这样的地址：
`https://fund-management-system-xxx.streamlit.app`

### 分享给合伙人
直接将这个网址发给合伙人即可！

### 数据共享确认
- ✅ 您录入的数据，合伙人立即可见
- ✅ 合伙人的操作，您也能实时看到
- ✅ 支持多人同时在线使用

## 🔧 后续维护

### 添加新功能
1. 在本地修改代码
2. 推送到GitHub
3. Streamlit Cloud自动更新

### 数据备份
- Supabase自动备份
- 可以随时导出CSV文件

### 成本估算
- Supabase：免费额度500MB
- Streamlit Cloud：完全免费
- GitHub：免费
- **总成本：¥0/月**

## ⚠️ 注意事项

1. **数据安全**：
   - 不要在代码中写密钥
   - 使用Streamlit Secrets管理

2. **性能优化**：
   - 免费版有并发限制
   - 数据量大时考虑付费版

3. **备份策略**：
   - 定期导出重要数据
   - 重要操作前先备份

---

准备好开始部署了吗？我可以逐步指导您完成每个步骤！
